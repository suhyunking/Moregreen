<!--
=========================================================
* Material Dashboard 2 - v3.0.4
=========================================================

* Product Page: https://www.creative-tim.com/product/material-dashboard
* Copyright 2022 Creative Tim (https://www.creative-tim.com)
* Licensed under MIT (https://www.creative-tim.com/license)
* Coded by Creative Tim

=========================================================

* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
-->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<th:block th:fragment="setContent( section )">
<head>

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<link rel="apple-touch-icon" sizes="76x76" th:href="@{img/apple-icon.png}">
<link rel="icon" type="image/png" th:href="@{img/moregreen.png}">
<title>Moregreen admin</title>

<!--     Fonts and icons     -->
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900|Roboto+Slab:400,700" />

<!-- Material Icons -->
<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
<link id="pagestyle" th:href="@{/css/material-dashboard.css}" rel="stylesheet" />
<link rel="stylesheet" type="text/css" th:href="@{/css/index.css}" />
<!-- Nucleo Icons -->
<link th:href="@{/css/nucleo-icons.css}" rel="stylesheet" />
<link th:href="@{/css/nucleo-svg.css}" rel="stylesheet" />
<link th:href="@{/css/main.css}" rel="stylesheet" />
<link th:href="@{/css/main1.css}" rel="stylesheet" />

<!-- Font Awesome Icons -->
<script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script th:inline="javascript">
				
	$(document).ready(function(){
		var menu = JSON.parse('[[${menu}]]'); //문자열
		$(".navbar-nav li a").each(function(index, value){
			
			if($(value).attr('href') == menu) {
				$(value).attr('class', 'nav-link text-white active bg-gradient-primary');
			}
		});
	});
		
</script>
<style>
.dropbtn {
  background-color: #04AA6D;
  color: white;
  padding: 16px;
  font-size: 16px;
  border: none;
}

.dropdown {
  position: relative;
  display: inline-block;
}

.dropdown-content {
  display: none;
  position: absolute;
  background-color: #f1f1f1;
  min-width: 160px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 1;
}

.dropdown-content a {
  color: black;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
}

.dropdown-content a:hover {background-color: #ddd;}

.dropdown:hover .dropdown-content {display: block;}

.dropdown:hover .dropbtn {background-color: #3e8e41;}
</style>

	</head>
		<body class="g-sidenav-show  bg-gray-100">
			<aside class="sidenav navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-3   bg-gradient-dark" id="sidenav-main">
				  <div class="sidenav-header">
					    <i class="fas fa-times p-3 cursor-pointer text-white opacity-5 position-absolute end-0 top-0 d-none d-xl-none" aria-hidden="true" id="iconSidenav"></i>
						<a class="navbar-brand m-0" th:href="@{/admin/userList}"> 
							<img src="../img/logo/logo3.png" class="navbar-brand-/img h-100" alt="main_logo"> 
						</a>
				  </div>
		  		<hr class="horizontal light mt-0 mb-2">
				  <div class="collapse navbar-collapse  w-auto " id="sidenav-collapse-main" style=" height: calc(100vh - 150px);">
				    	<ul class="navbar-nav">
							<li class="nav-item">
								<a class="nav-link text-white " th:href="@{/admin/userList}">
									<div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
										<i class="material-icons opacity-10">table_view</i>
									</div> 
									<span class="nav-link-text ms-1">회원 정보</span>
								</a>
							</li>
							<li class="nav-item">
								<a class="nav-link text-white " th:href="@{/admin/fundingList}">
									<div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
										<i class="material-icons opacity-10">view_list</i>
									</div> 
									<span class="nav-link-text ms-1">펀딩 관리</span>
								</a>
							</li>
							<li class="nav-item">
								<a class="nav-link text-white " th:href="@{/admin/fundingApplyList}">
									<div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
										<i class="material-icons opacity-10">view_list</i>
									</div> <span class="nav-link-text ms-1">프로젝트 신청 내역</span>
								</a>
							</li>
							<li class="nav-item">
								<a class="nav-link text-white " th:href="@{/admin/fundingOrderList}">
									<div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
										<i class="material-icons opacity-10">view_list</i>
									</div> <span class="nav-link-text ms-1">펀딩 주문내역</span>
								</a>
							</li>
						</ul>
  					</div>
				</aside>
				<!-- End Navbar -->
				<main class="main-content border-radius-lg ">
				<div class="container-fluid py-4">
					<div class="d-grid gap-2 d-md-flex justify-content-md-end">
				<div>
					<ul>
						<li class="nav-item dropdown pe-4 d-flex align-items-center">
							<a class="nav-link text-body p-0" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false"> 
								<i class="fa fa-bell cursor-pointer"></i>
							</a>
							<div class="dropdown-menu dropdown-menu-end px-2 py-4 me-sm-n0" style="width:310px;" aria-labelledby="dropdownMenuButton">
						        <div class="col-lg-8 col-md-10 mx-auto" style="width:290px;">
						            <div class="card-header" >
						              <span class="mb-2">프로젝트 개설 알람</span>
						            </div>
						            <div class="card-body p-0 pb-0" id="test1">
						              <th:block th:each="alarmDto : ${alarmList}" >
							              <div class="alert alert-primary alert-dismissible text-white" role="alert" style="padding-right:0rem;">
							                <input type="hidden" name="a_num" th:value="${alarmDto.a_num}">
						                	<a th:onclick="|deleteAlarm('${alarmDto.a_num}')|" th:href="@{/admin/fundingConfirm(f_num=${alarmDto.funding_f_num})}">[[${alarmDto.a_message}]]</a>
						              	  </div>
						              </th:block>
						            </div>
								</div>
							</div>
						</li>
					</ul>
				</div>
				<div>
					<i class="fa fa-user me-sm-1"></i>
	                <span class="d-sm-inline d-none" th:if="${session.member!=null}">[[${session.member.m_id}]]</span>
            	</div>
            	<div>
            		<a th:href="@{/admin/logout}" class="nav-link text-body font-weight-bold px-3">  
	                <span class=" ">로그아웃</span>
              		</a>
            	</div>
			</div>
			</div>
			<th:block th:replace="${section}"></th:block>
		</main>
	</body>

<!--   Core JS Files   -->
<script src="../js/core/popper.min.js"></script>
<script src="../js/core/bootstrap.min.js"></script>
<script src="../js/plugins/perfect-scrollbar.min.js"></script>
<script src="../js/plugins/smooth-scrollbar.min.js"></script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.1.5/sockjs.min.js"></script>
<script th:inline="javascript">

//전역변수 선언-모든 홈페이지에서 사용 할 수 있게 index에 저장
var socket = null;

$(document).ready(function (){
	   connectWs();
});

function connectWs(){
	sock = new SockJS([[@{'/myHandler'}]]);
	socket = sock;

	sock.onopen = function() {
        console.log('myHandler와의 커넥션이 열렸습니다.');
  	};

	 sock.onmessage = function(event) {
		 	var data = event.data;
		 	var funding_f_num = data.slice(-17,-15);
		 	$("#test1").prepend("<div class='alert alert-primary alert-dismissible text-white' role='alert' style='padding-right:0rem;'>" + 
		 						"<a onclick='deleteAlarmByFNum(" + funding_f_num +")' href='/admin/fundingConfirm?f_num=" + funding_f_num + "'>" + data + "</a></div>");
		   	/* $.ajax({
				url : '/mentor/member/countAlarm',
				type : 'POST',
				dataType: 'text',
				success : function(data) {
					if(data == '0'){
					}else{
						$('#alarmCountSpan').addClass('bell-badge-danger bell-badge')
						$('#alarmCountSpan').text(data);
					}
				},
				error : function(err){
					alert('err');
				}
		   	}); */
	
	       
	 };

	 sock.onclose = function() {
	   	console.log('커넥션 종료');
	   	setTimeout(function(){conntectWs();} , 1000);
	 };
	
	 sock.onerror = function (err) {
		 console.log('Errors : ' , err);
	 };

}

function deleteAlarmByFNum(funding_f_num) {
	
	var data = {
		"funding_f_num" : funding_f_num
	};
	
	$.ajax({
		url : [[@{'/alarm/removeAlarmByFNum'}]],
		type : 'POST',
		data : JSON.stringify(data),
 		contentType: "application/json; charset=utf-8",
 		dataType : 'text',
		success : function(data) {
				console.log("삭제 완료");				
		},
		error : function(err){
			alert('err');
		}
   	});
}

var a_num = null;
function deleteAlarm(a_num) {
	console.log(a_num);
	
	var data = {
		"a_num" : a_num
	};
	
	$.ajax({
		url : [[@{'/alarm/removeAlarm'}]],
		type : 'POST',
		data : JSON.stringify(data),
 		contentType: "application/json; charset=utf-8",
 		dataType : 'text',
		success : function(data) {
				console.log("삭제 완료");				
		},
		error : function(err){
			alert('err');
		}
   	});
}

	var win = navigator.platform.indexOf('Win') > -1;
	if (win && document.querySelector('#sidenav-scrollbar')) {
		var options = {
			damping : '0.5'
		}
		Scrollbar.init(document.querySelector('#sidenav-scrollbar'),
		options);
	}
</script>

<!-- Github buttons -->
<script async defer src="https://buttons.github.io/buttons.js"></script>

<!-- Control Center for Material Dashboard: parallax effects, scripts for the example pages etc -->
</html>